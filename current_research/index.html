---
layout: default
title: Current Research
---

{% assign sorted_projects = site.projects | sort: 'name' %}
{% include populate_filters.html %}

<div class="current-research-page">
  <h1>Current Research</h1>

  <!-- Categories -->
  <div class="research-categories-row">
    <div class="category-card">
      <img src="{{ site.baseurl }}/images/projects/categories/active.png" alt="Active Sensing" />
      <h2>Active Sensing</h2>
      <p>These projects involve assessments that require people to perform a particular task in order to learn something about their health.</p>
    </div>
    <div class="category-card">
      <img src="{{ site.baseurl }}/images/projects/categories/passive.png" alt="Passive Sensing" />
      <h2>Passive Sensing</h2>
      <p>These projects involve the use of sensors to detect digital health biomarkers without requiring direct involvement from the people being monitored.</p>
    </div>
    <div class="category-card">
      <img src="{{ site.baseurl }}/images/projects/categories/design.png" alt="Design" />
      <h2>Design</h2>
      <p>These projects involve studying people's experiences as they interact with health-related technologies.</p>
    </div>
  </div>

  <button class="mobile-filter-toggle btn">Filters</button>

  <div class="filter-overlay">
    <div class="filter-panel">
      <header>
        <button class="close-filters">×</button>
      </header>

      <div class="filter-section">

        <!-- --- Theme (Categories) --- -->
        <h3>Theme</h3>
        {% for theme in themes %}
          <label>
            <input type="checkbox" class="filter-category" value="{{ theme }}" /> {{ theme }}
          </label><br />
        {% endfor %}
        <hr />

        <!-- --- Health Topic --- -->
        <h3>Health Topic</h3>
        <select id="mobile-filter-health-topic">
          <option value="">All</option>
          {% for topic in healthTopics %}
            <option value="{{ topic }}">{{ topic }}</option>
          {% endfor %}
        </select>
        <hr />

        <!-- --- Skills --- -->
        <h3>Skills</h3>
        {% for skill in skills %}
          <label>
            <input type="checkbox" class="filter-skill" value="{{ skill }}" /> {{ skill }}
          </label><br />
        {% endfor %}
        <hr />

        <!-- --- Led By --- -->
        <h3>Graduate Student Lead</h3>
        <select id="mobile-filter-led-by">
          <option value="">Anyone</option>
          {% for lead in all_lead_ids %}
            {% assign found_member = site.data.members | where:"id", lead | first %}
            {% if found_member %}
              <option value="{{ found_member.id }}">{{ found_member.name }}</option>
            {% else %}
              <option value="{{ lead }}">{{ lead }}</option>
            {% endif %}
          {% endfor %}
        </select>
        <button class="apply-filters btn">Apply</button>
      </div>
    </div>
  </div>


  <!-- Filter + Projects layout -->
  <div class="research-content-row">
    <!-- Left Column: Dynamic Filter Section -->
    <div class="filter-section">
      <!-- --- Theme (Categories) --- -->
      <h3>Theme</h3>
      {% for theme in themes %}
        <label>
          <input type="checkbox" class="filter-category" value="{{ theme }}" /> {{ theme }}
        </label><br />
      {% endfor %}
      <hr />

      <!-- --- Health Topic --- -->
      <h3>Health Topic</h3>
      <select id="filter-health-topic">
        <option value="">All</option>
        {% for topic in healthTopics %}
          <option value="{{ topic }}">{{ topic }}</option>
        {% endfor %}
      </select>
      <hr />

      <!-- --- Skills --- -->
      <h3>Skills</h3>
      {% for skill in skills %}
      <label>
        <input type="checkbox" class="filter-skill" value="{{ skill }}" /> {{ skill }}
      </label><br />
      {% endfor %}
      <hr />

      <!-- --- Led By --- -->
      <h3>Graduate Student Lead</h3>
      <select id="filter-led-by">
        <option value="">Anyone</option>
        {% for lead in all_lead_ids %}
          {% assign found_member = site.data.members | where:"id", lead | first %}
          {% if found_member %}
            <option value="{{ found_member.id }}">{{ found_member.name }}</option>
          {% else %}
            <option value="{{ lead }}">{{ lead }}</option>
          {% endif %}
        {% endfor %}
      </select>
    </div>

    <!-- Right Column: Projects Grid -->
    <div class="projects-grid">
      <div id="active-filters-panel"></div>
      <div class="project-cards-wrapper">
        {% for project in sorted_projects %}
        <div class="project-card"
             data-category="{{ project.category | join: ', ' }}"
             data-health-topic="{{ project.health_topic | join: ', ' }}"
             data-skills="{{ project.skills | join: ', ' }}"
             data-leads="{{ project.leads | join: ', ' }}">
          <div class="project-image">
            <img src="{{ project.thumbnail }}" alt="{{ project.title }}" />
          </div>
          <div class="project-card-content">
            <h3 class="project-title">{{ project.title }}</h3>
            <p><strong>Project Lead(s):</strong> {% include author_list.html authors=project.leads %}</p>
            <p><strong>Goal:</strong> {{ project.description }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Desktop filters
    const themeCheckboxes  = Array.from(document.querySelectorAll('.filter-category'));
    const skillCheckboxes  = Array.from(document.querySelectorAll('.filter-skill'));
    const healthSelect  = document.getElementById('filter-health-topic');
    const leadSelect    = document.getElementById('filter-led-by');

    // Mobile filters???
    const mobileThemeCheckboxes = document.querySelectorAll('.mobile-filter-category')
    const mobileSkillCheckboxes = document.querySelectorAll('.mobile-filter-skill');
    const mobileHealthSelect = document.getElementById('mobile-filter-health-topic');
    const mobileLeadSelect = document.getElementById('mobile-filter-led-by');

    // Common elements
    const projectCards  = Array.from(document.querySelectorAll('.project-card'));
    const activePanel   = document.getElementById('active-filters-panel');

    // Mobile filter overlay controls
    const overlay       = document.querySelector('.filter-overlay');
    const openBtn       = document.querySelector('.mobile-filter-toggle');
    const closeBtn      = document.querySelector('.close-filters');
    const applyBtn      = document.querySelector('.apply-filters');

    if (!overlay || !openBtn || !closeBtn || !applyBtn) return;

    openBtn.addEventListener('click',  () => overlay.classList.add('active'));
    closeBtn.addEventListener('click', () => overlay.classList.remove('active'));

    function syncFilters(fromMobile = false) {
      if (fromMobile) {
        // Copy from mobile to desktop
        healthSelect.value = mobileHealthSelect.value;
        leadSelect.value = mobileLeadSelect.value;

        mobileThemeCheckboxes.forEach((checkbox, index) => {
          if (index < themeCheckboxes.length) {
            themeCheckboxes[index].checked = checkbox.checked;
          }
        });

        mobileSkillCheckboxes.forEach((checkbox, index) => {
          if (index < skillCheckboxes.length) {
            skillCheckboxes[index].checked = checkbox.checked;
          }
        });
      } else {
        // Copy from desktop to mobile
        mobileHealthSelect.value = healthSelect.value;
        mobileLeadSelect.value = leadSelect.value;

        // Sync checkboxes
        themeCheckboxes.forEach((checkbox, index) => {
          if (index < mobileThemeCheckboxes.length) {
            mobileThemeCheckboxes[index].checked = checkbox.checked;
          }
        });

        skillCheckboxes.forEach((checkbox, index) => {
          if (index < mobileSkillCheckboxes.length) {
            mobileSkillCheckboxes[index].checked = checkbox.checked;
          }
        });
      }
    }

    function filterProjects() {
      const cats  = themeCheckboxes.filter(c=>c.checked).map(c=>c.value);
      const skills= skillCheckboxes.filter(c=>c.checked).map(c=>c.value);
      const health= healthSelect.value;
      const lead  = leadSelect.value;

      projectCards.forEach(card => {
        let show = true;
        if (cats.length && !cats.some(c=>card.dataset.category.includes(c))) show = false;
        if (skills.length && !skills.every(s=>card.dataset.skills.includes(s)))   show = false;
        if (health && !card.dataset.healthTopic.includes(health))                  show = false;
        if (lead   && !card.dataset.leads.includes(lead))                          show = false;
        card.style.display = show ? 'block' : 'none';
      });
      updateActiveFilters();
    }

    function updateActiveFilters() {
      activePanel.innerHTML = '';
      const hasActiveFilters =
              themeCheckboxes.some(c => c.checked) ||
              skillCheckboxes.some(c => c.checked) ||
              healthSelect.value ||
              leadSelect.value;

      if (!hasActiveFilters) {
        activePanel.style.display = 'none';
        return;
      }
      activePanel.style.display = 'block';

      themeCheckboxes.filter(c=>c.checked).forEach(c => {
        activePanel.innerHTML += `<span class="active-filter-tag">Theme: ${c.value} <span class="remove-tag" data-type="category" data-value="${c.value}">×</span></span>`;
      });

      if (healthSelect.value) {
        activePanel.innerHTML += `<span class="active-filter-tag">Health Topic: ${healthSelect.selectedOptions[0].text} <span class="remove-tag" data-type="health" data-value="">×</span></span>`;
      }

      skillCheckboxes.filter(c=>c.checked).forEach(c => {
        activePanel.innerHTML += `<span class="active-filter-tag">Skill: ${c.value} <span class="remove-tag" data-type="skill" data-value="${c.value}">×</span></span>`;
      });

      if (leadSelect.value) {
        const name = leadSelect.selectedOptions[0].text;
        activePanel.innerHTML += `<span class="active-filter-tag">Led by: ${name} <span class="remove-tag" data-type="lead" data-value="">×</span></span>`;
      }

      activePanel.querySelectorAll('.remove-tag').forEach(el => {
        el.addEventListener('click', function() {
          const type = this.dataset.type;
          const value = this.dataset.value;
          removeFilter(type, value);
        });
      });
    }

    function removeFilter(type, value) {
      if (type === 'category') {
        themeCheckboxes.find(c=>c.value===value).checked = false;
      } else if (type === 'skill') {
        skillCheckboxes.find(c=>c.value===value).checked = false;
      } else if (type === 'health') {
        healthSelect.value = '';
      } else if (type === 'lead') {
        leadSelect.value = '';
      }
      syncFilters();
      filterProjects();
    }

    window.removeFilter = removeFilter;

    [...themeCheckboxes, ...skillCheckboxes].forEach(c=>c.addEventListener('change', () => {
      syncFilters();
      filterProjects();
    }));

    healthSelect.addEventListener('change', () => {
      syncFilters();
      filterProjects();
    });

    leadSelect.addEventListener('change', () => {
      syncFilters();
      filterProjects();
    });

    applyBtn.addEventListener('click', () => {
      syncFilters(true);
      filterProjects();
      overlay.classList.remove('active');
    });

    const grid = document.querySelector('.projects-grid');
    if (grid && projectCards.length>1) {
      const top = projectCards[0].getBoundingClientRect().top;
      const multi = projectCards.some(c=>c.getBoundingClientRect().top > top+1);
      grid.classList.toggle('equal-height', multi);
    }

    // Initialize active filters panel
    updateActiveFilters();
  });
</script>