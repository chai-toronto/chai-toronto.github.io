---
layout: default
title: Current Research
---

{% assign sorted_projects = site.projects | sort: 'name' %}
{% include populate_filters.html %}

<div class="current-research-page">
  <h1>Current Research</h1>

  <!-- Categories -->
  <div class="research-themes-row">
    <div class="theme-card">
      <img src="{{ site.baseurl }}/images/projects/themes/active.png" alt="Active Sensing" />
      <h2>Active Sensing</h2>
      <p>These projects involve assessments that require people to perform a particular task in order to learn something about their health.</p>
    </div>
    <div class="theme-card">
      <img src="{{ site.baseurl }}/images/projects/themes/passive.png" alt="Passive Sensing" />
      <h2>Passive Sensing</h2>
      <p>These projects involve the use of sensors to detect digital health biomarkers without requiring direct involvement from the people being monitored.</p>
    </div>
    <div class="theme-card">
      <img src="{{ site.baseurl }}/images/projects/themes/design.png" alt="Design" />
      <h2>Design</h2>
      <p>These projects involve studying people's experiences as they interact with health-related technologies.</p>
    </div>
  </div>

  <hr class="custom-divider-line">

  <button class="mobile-filter-toggle btn">Filters</button>

  <div class="filter-overlay">
    <div class="filter-panel">
      <header>
        <button class="close-filters">×</button>
      </header>

      <div class="filter-section">

        <!-- --- Theme (Categories) --- -->
        <h3>Theme</h3>
        {% for theme in themes %}
          <label>
            <input type="checkbox" class="mobile-filter-theme" value="{{ theme }}" /> {{ theme }}
          </label><br />
        {% endfor %}
        <hr />

        <!-- --- Health Topic --- -->
        <h3>Health Topic</h3>
        <select id="mobile-filter-health-topic">
          <option value="">All</option>
          {% for topic in healthTopics %}
            <option value="{{ topic }}">{{ topic }}</option>
          {% endfor %}
        </select>
        <hr />

        <!-- --- Skills --- -->
        <h3>Skills</h3>
        {% for skill in skills %}
          <label>
            <input type="checkbox" class="mobile-filter-skill" value="{{ skill }}" /> {{ skill }}
          </label><br />
        {% endfor %}
        <button class="apply-filters btn">Apply</button>
      </div>
    </div>
  </div>


  <!-- Filter + Projects layout -->
  <div class="research-content-row">
    <!-- Left Column: Dynamic Filter Section -->
    <div class="filter-section">
      <!-- --- Theme (Categories) --- -->
      <h3>Theme</h3>
      {% for theme in themes %}
        <label>
          <input type="checkbox" class="filter-theme" value="{{ theme }}" /> {{ theme }}
        </label><br />
      {% endfor %}
      <hr />

      <!-- --- Health Topic --- -->
      <h3>Health Topic</h3>
      <select id="filter-health-topic">
        <option value="">All</option>
        {% for topic in healthTopics %}
          <option value="{{ topic }}">{{ topic }}</option>
        {% endfor %}
      </select>
      <hr />

      <!-- --- Skills --- -->
      <h3>Skills</h3>
      {% for skill in skills %}
      <label>
        <input type="checkbox" class="filter-skill" value="{{ skill }}" /> {{ skill }}
      </label><br />
      {% endfor %}
    </div>

    <!-- Right Column: Projects Grid -->
    <div class="projects-grid">
      <div id="active-filters-panel"></div>
      <div class="project-cards-wrapper">
        {% for project in sorted_projects %}
        <div class="project-card"
             data-theme="{{ project.theme | join: ', ' }}"
             data-health-topic="{{ project.health_topic | join: ', ' }}"
             data-skills="{{ project.skills | join: ', ' }}">
          <div class="project-image">
            <img src="{{ project.thumbnail }}" alt="{{ project.title }}" />
          </div>
          <div class="project-card-content">
            <h3 class="project-title">{{ project.title }}</h3>
            <p><strong>Project Lead(s):</strong> {% include author_list.html authors=project.leads %}</p>
            <p><strong>Goal:</strong> {{ project.description }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Desktop filters
    const healthTopicSelect = document.getElementById('filter-health-topic');
    const themeCheckboxes = Array.from(document.querySelectorAll('.filter-theme'));
    const skillCheckboxes = Array.from(document.querySelectorAll('.filter-skill'));

    // Mobile filters
    const mobileHealthTopicSelect = document.getElementById('mobile-filter-health-topic');
    const mobileThemeCheckboxes = Array.from(document.querySelectorAll('.mobile-filter-theme'));
    const mobileSkillCheckboxes = Array.from(document.querySelectorAll('.mobile-filter-skill'));

    // Common elements
    const projectCards = Array.from(document.querySelectorAll('.project-card'));
    const activeFiltersPanel = document.getElementById('active-filters-panel');

    // Mobile filter overlay controls
    const overlay = document.querySelector('.filter-overlay');
    const openBtn = document.querySelector('.mobile-filter-toggle');
    const closeBtn = document.querySelector('.close-filters');
    const applyBtn = document.querySelector('.apply-filters');

    // Toggle mobile filter overlay
    if (overlay && openBtn && closeBtn) {
      openBtn.addEventListener('click',  () => overlay.classList.add('active'));
      closeBtn.addEventListener('click', () => overlay.classList.remove('active'));
    }

    // Sync filters between desktop and mobile
    function syncFilters(fromMobile = false) {
      if (fromMobile) {
        // Copy from mobile to desktop
        healthTopicSelect.value = mobileHealthTopicSelect.value;

        mobileThemeCheckboxes.forEach((checkbox, index) => {
          if (index < themeCheckboxes.length) {
            themeCheckboxes[index].checked = checkbox.checked;
          }
        });

        mobileSkillCheckboxes.forEach((checkbox, index) => {
          if (index < skillCheckboxes.length) {
            skillCheckboxes[index].checked = checkbox.checked;
          }
        });
      } 
      else {
        // Copy from desktop to mobile
        mobileHealthTopicSelect.value = healthTopicSelect.value;

        // Sync checkboxes
        themeCheckboxes.forEach((checkbox, index) => {
          if (index < mobileThemeCheckboxes.length) {
            mobileThemeCheckboxes[index].checked = checkbox.checked;
          }
        });

        skillCheckboxes.forEach((checkbox, index) => {
          if (index < mobileSkillCheckboxes.length) {
            mobileSkillCheckboxes[index].checked = checkbox.checked;
          }
        });
      }
    }

    function getCheckedValues(checkboxes) {
      let values = [];
      checkboxes.forEach(cb => {
        if(cb.checked) {
          values.push(cb.value);
        }
      });
      return values;
    }

    function filterProjects() {
      const selectedHealthTopic = healthTopicSelect.value;
      const selectedThemes = getCheckedValues(themeCheckboxes);
      const selectedSkills = getCheckedValues(skillCheckboxes);

      projectCards.forEach(card => {
        // Dropdowns
        if (selectedHealthTopic && !card.dataset.healthTopic.includes(selectedHealthTopic)) {
          card.style.display = 'none';
          return;
        }
        // Checkboxes
        if (selectedThemes.length > 0) {
          const cardThemes = card.dataset.theme.split(',').map(t => t.trim());
          if (!selectedThemes.some(theme => cardThemes.includes(theme))) {
            card.style.display = 'none';
            return;
          }
        }
        if (selectedSkills.length > 0) {
          const cardSkills = card.dataset.skills.split(',').map(s => s.trim());
          if (!selectedSkills.some(skill => cardSkills.includes(skill))) {
            card.style.display = 'none';
            return;
          }
        }
        card.style.display = 'block';
      });
      updateActiveFilters();
    }

    function updateActiveFilters() {
      // Skip early if no filters are active
      activeFiltersPanel.innerHTML = '';
      const hasActiveFilters =
              healthTopicSelect.value ||
              themeCheckboxes.some(c => c.checked) ||
              skillCheckboxes.some(c => c.checked);

      if (!hasActiveFilters) {
        activeFiltersPanel.style.display = 'none';
        return;
      }
      activeFiltersPanel.style.display = 'block';

      // Dropdowns
      if (healthTopicSelect.value) {
        activeFiltersPanel.innerHTML += `<span class="active-filter-tag">Health Topic: ${healthTopicSelect.selectedOptions[0].text} <span class="remove-tag" data-type="health" data-value="">×</span></span>`;
      }
      // Checkboxes
      themeCheckboxes.filter(c=>c.checked).forEach(c => {
        activeFiltersPanel.innerHTML += `<span class="active-filter-tag">Theme: ${c.value} <span class="remove-tag" data-type="theme" data-value="${c.value}">×</span></span>`;
      });
      skillCheckboxes.filter(c=>c.checked).forEach(c => {
        activeFiltersPanel.innerHTML += `<span class="active-filter-tag">Skill: ${c.value} <span class="remove-tag" data-type="skill" data-value="${c.value}">×</span></span>`;
      });

      activeFiltersPanel.querySelectorAll('.remove-tag').forEach(el => {
        el.addEventListener('click', function() {
          const type = this.dataset.type;
          const value = this.dataset.value;
          removeFilter(type, value);
        });
      });
    }

    function removeFilter(type, value) {
      // Dropdowns
      if (type === 'health') {
        healthTopicSelect.value = '';
        mobileHealthTopicSelect.value = '';
      } 
      // Checkboxes
      else if (type === 'theme') {
        themeCheckboxes.forEach(cb => {
          if (cb.value === value) cb.checked = false;
        });
        mobileThemeCheckboxes.forEach(cb => {
          if (cb.value === value) cb.checked = false;
        });
      } 
      else if (type === 'skill') {
        skillCheckboxes.forEach(cb => {
          if (cb.value === value) cb.checked = false;
        });
        mobileSkillCheckboxes.forEach(cb => {
          if (cb.value === value) cb.checked = false;
        });
      } 
      syncFilters();
      filterProjects();
    }

    // Dropdown filter event listeners
    [healthTopicSelect].forEach(select => {
      select.addEventListener('change', () => {
        syncFilters();
        filterProjects();
      });
    });

    // Checkbox filter event listeners
    [...themeCheckboxes, ...skillCheckboxes].forEach(c=>c.addEventListener('change', () => {
      syncFilters();
      filterProjects();
    }));

    // Apply button event listener
    applyBtn.addEventListener('click', () => {
      syncFilters(true);
      filterProjects();
      overlay.classList.remove('active');
    });

    const grid = document.querySelector('.projects-grid');
    if (grid && projectCards.length>1) {
      const top = projectCards[0].getBoundingClientRect().top;
      const multi = projectCards.some(c=>c.getBoundingClientRect().top > top+1);
      grid.classList.toggle('equal-height', multi);
    }

    // Initialize active filters panel
    updateActiveFilters();
  });
</script>